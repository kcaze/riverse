<!doctype html>
<html>
<head>
<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
<style>
@font-face {
  font-family: 'f';
  src: url('f.woff');
}
</style>
<title>Zodiac 13</title>
</head>
<body>
  <center>
    <canvas id="canvas" width="280px" height="390px">
    </canvas>
  </center>
  <script src="js/base64.js"></script>
  <script src="js/ios_hacks.js"></script>
  <script src="js/sonantx.js"></script>
  <script src="js/jsfxr.js"></script>
  <script src="js/engine.js"></script>
  <script src="js/riverse_loading.js"></script>
  <script src="js/riverse_main_menu.js"></script>
  <script src="js/riverse_records.js"></script>
  <script src="js/riverse_character_select.js"></script>
  <script src="js/riverse_game.js"></script>
  <script src="js/riverse.js"></script>
  <p id="fontHack" style="font-family: 'f';">Hello</p>
  <!--
  <script>
  function base64ToArrayBuffer(b){b=window.atob(b);for(var a=b.length,d=new Uint8Array(a),c=0;c<a;c++)d[c]=b.charCodeAt(c);return d.buffer}var performance=window.performance?window.performance:window.Date,AudioContext=window.AudioContext?window.AudioContext:window.webkitAudioContext;String.prototype.repeat||(String.prototype.repeat=function(b){for(var a=""+this,d="";;){1==(b&1)&&(d+=a);b>>>=1;if(0==b)break;a+=a}return d});
document.addEventListener("touchstart",function(b){b=kz.audio_context.createBuffer(1,1,22050);var a=kz.audio_context.createBufferSource();a.buffer=b;a.connect(kz.audio_context.destination);a.noteOn(0)},!1);var sonantx;
(function(){function b(k){return Math.sin(6.283184*k)}function a(k,a){setTimeout(function(){var c=new Uint8Array(4*k),b=c.length-2,f=function(){for(var k=new Date,d=0;0<=b;)if(c[b]=0,c[b+1]=128,b-=2,d+=1,0===d%1E3&&100<new Date-k){setTimeout(f,0);return}setTimeout(function(){a(c)},0)};setTimeout(f,0)},0)}function d(k,a,c,b,f){var d=c.n*b>>1,u=c.s/255,z=0,C=function(){for(var c=new Date,b=0;z<a-d;){var m=4*z,p=4*(z+d),n=k[p]+(k[p+1]<<8)+(k[m+2]+(k[m+3]<<8)-32768)*u;k[p]=n&255;k[p+1]=n>>8&255;n=k[p+
2]+(k[p+3]<<8)+(k[m]+(k[m+1]<<8)-32768)*u;k[p+2]=n&255;k[p+3]=n>>8&255;++z;b+=1;if(0===b%1E3&&100<new Date-c){setTimeout(C,0);return}}setTimeout(f,0)};setTimeout(C,0)}sonantx={};var c=null,f=[b,function(k){return 0>b(k)?-1:1},function(k){return k%1-.5},function(k){k=k%1*4;return 2>k?k-1:3-k}];sonantx.AudioGenerator=function(k){this.mixBuf=k;this.waveSize=k.length/2/2};sonantx.AudioGenerator.prototype.getWave=function(){var k=this.mixBuf,c,a,b,f,d,u=4*this.waveSize;c=u-8;a=c-36;f=String.fromCharCode(82,
73,70,70,c&255,c>>8&255,c>>16&255,c>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,a&255,a>>8&255,a>>16&255,a>>24&255);for(c=0;c<u;){b="";for(a=0;256>a&&c<u;++a,c+=2)d=4*(k[c]+(k[c+1]<<8)-32768),d=-32768>d?-32768:32767<d?32767:d,b+=String.fromCharCode(d&255,d>>8&255);f+=b}return f};sonantx.AudioGenerator.prototype.getAudio=function(){var c=this.getWave(),c=new Audio("data:audio/wav;base64,"+btoa(c));c.preload="none";c.load();return c};sonantx.AudioGenerator.prototype.getAudioBuffer=
function(a){null===c&&(c=new AudioContext);var b=this.mixBuf,f=this.waveSize,d=c.createBuffer(2,this.waveSize,44100),t=d.getChannelData(0),A=d.getChannelData(1),u=0,z=function(){for(var c=new Date,e=0;u<f;){var q=4*(b[4*u]+(b[4*u+1]<<8)-32768),q=-32768>q?-32768:32767<q?32767:q;t[u]=q/32768;q=4*(b[4*u+2]+(b[4*u+3]<<8)-32768);q=-32768>q?-32768:32767<q?32767:q;A[u]=q/32768;u+=1;e+=1;if(0===e%1E3&&100<new Date-c){setTimeout(z,0);return}}setTimeout(function(){a(d)},0)};setTimeout(z,0)};sonantx.SoundGenerator=
function(c,a){this.instr=c;this.rowLen=a||5605;this.osc_lfo=f[c.p];this.osc1=f[c.t];this.osc2=f[c.a];this.attack=c.ab;this.sustain=c.x;this.release=c.w;this.panFreq=Math.pow(2,c.l-8)/this.rowLen;this.lfoFreq=Math.pow(2,c.z-8)/this.rowLen};sonantx.SoundGenerator.prototype.genSound=function(c,a,f){var d=0,t=0,A=.00390625*Math.pow(1.059463094,c+12*(this.instr.ac-8)+this.instr.aa-128)*(1+8E-4*this.instr.h);c=.00390625*Math.pow(1.059463094,c+12*(this.instr.i-8)+this.instr.m-128)*(1+8E-4*this.instr.v);
for(var u=this.instr.k/255,z=0,C=0,e=this.attack+this.sustain+this.release-1;0<=e;--e){var q=e+f,r=this.osc_lfo(q*this.lfoFreq)*this.instr.e/512+.5,x=1;e<this.attack?x=e/this.attack:e>=this.attack+this.sustain&&(x-=(e-this.attack-this.sustain)/this.release);var n=A;this.instr.f&&(n+=r);this.instr.y&&(n=n*x*x);var d=d+n,l=this.osc1(d)*this.instr.r,n=c;this.instr.b&&(n=n*x*x);t+=n;l+=this.osc2(t)*this.instr.d;this.instr.g&&(l+=(2*Math.random()-1)*this.instr.g*x);l*=x/255;n=this.instr.o;this.instr.u&&
(n*=r);n=1.5*Math.sin(3.141592*n/44100);z+=n*C;r=u*(l-C)-z;C+=n*r;switch(this.instr.j){case 1:l=r;break;case 2:l=z;break;case 3:l=C;break;case 4:l=z+r}n=b(q*this.panFreq)*this.instr.c/512+.5;l=39*l*this.instr._;q*=4;q+3<a.length&&(r=a[q]+(a[q+1]<<8)+l*(1-n),a[q]=r&255,a[q+1]=r>>8&255,r=a[q+2]+(a[q+3]<<8)+l*n,a[q+2]=r&255,a[q+3]=r>>8&255)}};sonantx.SoundGenerator.prototype.getAudioGenerator=function(c,b){var f=this.attack+this.sustain+this.release-1+32*this.rowLen,p=this;a(f,function(a){p.genSound(c,
a,0);d(a,f,p.instr,p.rowLen,function(){b(new sonantx.AudioGenerator(a))})})};sonantx.SoundGenerator.prototype.createAudio=function(c,a){this.getAudioGenerator(c,function(c){a(c.getAudio())})};sonantx.SoundGenerator.prototype.createAudioBuffer=function(c,a){this.getAudioGenerator(c,function(c){c.getAudioBuffer(a)})};sonantx.MusicGenerator=function(c){this.song=c;this.waveSize=44100*c.songLen};sonantx.MusicGenerator.prototype.generateTrack=function(c,b,f){var p=this;a(this.waveSize,function(a){var A=
p.waveSize,u=4*p.waveSize,z=p.song.rowLen,C=new sonantx.SoundGenerator(c,z),e=c.notes.length,q=0,r=0,x=function(){for(var b=new Date;;){if(r===e){setTimeout(n,0);break}var f=c.notes[r];f&&C.genSound(f,a,q);r++;q+=3*z;if(100<new Date-b){setTimeout(x,0);break}}},n=function(){d(a,A,c,z,v)},l=0,v=function(){for(var c=new Date,k=0;l<u;){var d=b[l]+(b[l+1]<<8)+a[l]+(a[l+1]<<8)-32768;b[l]=d&255;b[l+1]=d>>8&255;l+=2;k+=1;if(0===k%1E3&&100<new Date-c){setTimeout(v,0);return}}setTimeout(f,0)};setTimeout(x,
0)})};sonantx.MusicGenerator.prototype.getAudioGenerator=function(c){var b=this;a(this.waveSize,function(a){var f=0,d=function(){f<b.song.songData.length?(f+=1,b.generateTrack(b.song.songData[f-1],a,d)):c(new sonantx.AudioGenerator(a))};d()})};sonantx.MusicGenerator.prototype.createAudio=function(c){this.getAudioGenerator(function(a){c(a.getAudio())})};sonantx.MusicGenerator.prototype.createAudioBuffer=function(c){this.getAudioGenerator(function(a){a.getAudioBuffer(c)})}})();
function SfxrParams(){this.setSettings=function(b){for(var a=0;24>a;a++)this[String.fromCharCode(97+a)]=b[a]||0;.01>this.c&&(this.c=.01);b=this.b+this.c+this.e;.18>b&&(b=.18/b,this.b*=b,this.c*=b,this.e*=b)}}
function SfxrSynth(){this._params=new SfxrParams;var b,a,d,c,f,k,h,m,p,t,A,u;this.reset=function(){var a=this._params;c=100/(a.f*a.f+.001);f=100/(a.g*a.g+.001);k=1-a.h*a.h*a.h*.01;h=-a.i*a.i*a.i*1E-6;a.a||(A=.5-a.n/2,u=5E-5*-a.o);m=1+a.l*a.l*(0<a.l?-.9:10);p=0;t=1==a.m?0:(1-a.m)*(1-a.m)*2E4+32};this.totalReset=function(){this.reset();var c=this._params;b=c.b*c.b*1E5;a=c.c*c.c*1E5;d=c.e*c.e*1E5+12;return 3*((b+a+d)/3|0)};this.synthWave=function(z,C){var e=this._params,q=1!=e.s||e.v,r=e.v*e.v*.1,x=
1+3E-4*e.w,n=e.s*e.s*e.s*.1,l=1+1E-4*e.t,v=1!=e.s,S=e.x*e.x,T=e.g,y=e.q||e.r,L=e.r*e.r*e.r*.2,g=e.q*e.q*(0>e.q?-1020:1020),D=e.p?((1-e.p)*(1-e.p)*2E4|0)+32:0,B=e.d,F=e.j/2,H=e.k*e.k*.01,W=e.a,X=b,da=1/b,ea=1/a,fa=1/d,e=5/(1+e.u*e.u*20)*(.01+n);.8<e&&(e=.8);for(var e=1-e,Y=!1,ba=0,O=0,P=0,U=0,M=0,Q,N=0,E,I=0,K,Z=0,w,ca=0,J,aa=0,V=Array(1024),R=Array(32),G=V.length;G--;)V[G]=0;for(G=R.length;G--;)R[G]=2*Math.random()-1;for(G=0;G<C;G++){if(Y)return G;D&&++ca>=D&&(ca=0,this.reset());t&&++p>=t&&(t=0,c*=
m);k+=h;c*=k;c>f&&(c=f,0<T&&(Y=!0));E=c;0<F&&(aa+=H,E*=1+Math.sin(aa)*F);E|=0;8>E&&(E=8);W||(A+=u,0>A?A=0:.5<A&&(A=.5));if(++O>X)switch(O=0,++ba){case 1:X=a;break;case 2:X=d}switch(ba){case 0:P=O*da;break;case 1:P=1+2*(1-O*ea)*B;break;case 2:P=1-O*fa;break;case 3:P=0,Y=!0}y&&(g+=L,K=g|0,0>K?K=-K:1023<K&&(K=1023));q&&x&&(r*=x,1E-5>r?r=1E-5:.1<r&&(r=.1));J=0;for(var ga=8;ga--;){I++;if(I>=E&&(I%=E,3==W))for(Q=R.length;Q--;)R[Q]=2*Math.random()-1;switch(W){case 0:w=I/E<A?.5:-.5;break;case 1:w=1-I/E*2;
break;case 2:w=I/E;w=6.28318531*(.5<w?w-1:w);w=1.27323954*w+.405284735*w*w*(0>w?1:-1);w=.225*((0>w?-1:1)*w*w-w)+w;break;case 3:w=R[Math.abs(32*I/E|0)]}q&&(Q=N,n*=l,0>n?n=0:.1<n&&(n=.1),v?(M+=(w-N)*n,M*=e):(N=w,M=0),N+=M,U+=N-Q,w=U*=1-r);y&&(V[Z%1024]=w,w+=V[(Z-K+1024)%1024],Z++);J+=w}J=.125*J*P*S;z[G]=1<=J?32767:-1>=J?-32768:32767*J|0}return C}}var synth=new SfxrSynth;
window.jsfxr=function(b){synth._params.setSettings(b);var a=synth.totalReset();b=new Uint8Array(4*((a+1)/2|0)+44);var a=2*synth.synthWave(new Uint16Array(b.buffer,44),a),d=new Uint32Array(b.buffer,0,44);d[0]=1179011410;d[1]=a+36;d[2]=1163280727;d[3]=544501094;d[4]=16;d[5]=65537;d[6]=44100;d[7]=88200;d[8]=1048578;d[9]=1635017060;d[10]=a;for(var a=a+44,d=0,c="data:audio/wav;base64,";d<a;d+=3)var f=b[d]<<16|b[d+1]<<8|b[d+2],c=c+("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[f>>18]+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[f>>12&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[f>>6&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[f&63]);return c};
var kz={loadResources:function(b){var a=[];kz.resources={};a.push(kz.loadImages(b.images));a.push(kz.loadSounds(b.sounds));return Promise.all(a).then(function(){return kz.resources})},loadImages:function(b){var a={},d=[],c;for(c in b)d.push(new Promise(function(f){var d=b[c],h=document.createElement("canvas");a[c]=h;var m=new Image;m.addEventListener("load",function(){var c=h.getContext("2d");h.width=d.w;h.height=d.h;d.f?c.drawImage(m,d.x,d.y,d.W,d.H,(d.w-d.W)/2,(d.h-d.H)/2,d.W,d.H):c.drawImage(m,
d.x,d.y,d.w,d.h,0,0,d.w,d.h);f()});m.src="s.png"}));return Promise.all(d).then(function(){kz.resources.images=a;return kz.resources.images})}};kz.audio_context=new AudioContext;
kz.loadSounds=function(b){var a={},d=[],c;for(c in b)d.push(new Promise(function(d){var k=c;b[c].loader(b[c].data,function(c){a[k]={play:function(c){c=void 0==typeof c?!1:c;var a=kz.audio_context.createBufferSource();a.loop=c;a.buffer=this.buffer;a.connect(kz.audio_context.destination);a.start(0);return a},buffer:c};d()})}));return Promise.all(d).then(function(){kz.resources.sounds=a;return kz.resources.sounds})};kz.KEYS={ENTER:13,ESCAPE:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,Z:90};
kz.keys_status={};for(var ii=0;256>ii;ii++)kz.keys_status[ii]=0;kz.TOUCHES={};kz.tween=function(b){var a=performance.now(),d=b.object[b.property],c=b.value,f=b.duration?b.duration:Math.abs(c-d)/b.rate;return new Promise(function(k){function h(){var m=(performance.now()-a)/f;1<=m?(b.object[b.property]=c,k()):(b.object[b.property]=m*c+(1-m)*d,window.requestAnimationFrame(h))}window.requestAnimationFrame(h)})};kz.events=[];kz.sendEvent=function(b){kz.events.push(b)};
kz.processEvents=function(){for(var b=0;b<kz.events.length;b++)for(var a in kz.entities)kz.entities[a].listen(kz.events[b]);kz.events=[]};kz.__entity_id__=0;kz.Entity=function(b){for(name in b)b.hasOwnProperty(name)&&(this[name]=b[name]);this.__entity_id__=kz.__entity_id__;kz.entities[this.__entity_id__]=this;kz.__entity_id__++};kz.Entity.prototype.x=0;kz.Entity.prototype.y=0;kz.Entity.prototype.listen=function(){};kz.Entity.prototype.destroy=function(){delete kz.entities[this.__entity_id__]};
kz.Scene=function(){};kz.Scene.prototype.initialize=function(){};kz.Scene.prototype.preUpdate=function(){};kz.Scene.prototype.postUpdate=function(){};kz.Scene.prototype.draw=function(){};kz.Scene.prototype.exit=function(){};kz.initializeCanvas=function(b){kz.canvas=document.getElementById(b);kz.context=kz.canvas.getContext("2d");kz.context.clearAll=function(){kz.context.clearRect(0,0,kz.canvas.width,kz.canvas.height)}};
kz.initialize=function(b){kz.initializeCanvas(b);document.addEventListener("keydown",function(a){a.preventDefault();0==kz.keys_status[a.which]?(kz.keys_status[a.which]=1,a.kztype="keypress"):a.kztype="keyheld";kz.events.push(a)});document.addEventListener("keyup",function(a){a.preventDefault();a.kztype="keyup";kz.keys_status[a.which]=0;kz.events.push(a)});document.addEventListener("touchstart",function(a){for(var b=0;b<a.touches.length;b++){var c=a.touches[b];kz.TOUCHES[c.identifier]||(kz.TOUCHES[c.identifier]=
{initial:{x:c.screenX,y:c.screenY},current:{x:c.screenX,y:c.screenY}})}});document.addEventListener("touchmove",function(a){a.preventDefault();for(var b=0;b<a.touches.length;b++){var c=a.touches[b];kz.TOUCHES[c.identifier]&&(kz.TOUCHES[c.identifier].current={x:c.screenX,y:c.screenY})}});document.addEventListener("touchend",function(a){a.preventDefault();for(var b in kz.TOUCHES){for(var c=!1,f=0;f<a.touches.length;f++)a.touches[f].identifier==b&&(c=!0);if(!c){var c=kz.TOUCHES[b].initial.x,f=kz.TOUCHES[b].initial.y,
k=kz.TOUCHES[b].current.x,h=kz.TOUCHES[b].current.y;20>Math.abs(c-k)+Math.abs(f-h)&&kz.events.push({kztype:"keypress",which:kz.KEYS.Z});60>Math.abs(f-h)&&20<c-k&&kz.events.push({kztype:"keypress",which:kz.KEYS.LEFT});60>Math.abs(f-h)&&20<k-c&&kz.events.push({kztype:"keypress",which:kz.KEYS.RIGHT});60>Math.abs(c-k)&&20<h-f&&kz.events.push({kztype:"keypress",which:kz.KEYS.DOWN});60>Math.abs(c-k)&&20<f-h&&kz.events.push({kztype:"keypress",which:kz.KEYS.UP});delete kz.TOUCHES[b]}}})};var tickID;
kz.tick=function(b){kz.scene.preUpdate(kz.performance.now());kz.scene.draw(kz.performance.now());kz.scene.postUpdate(kz.performance.now());tickID=window.requestAnimationFrame(kz.tick)};kz.run=function(b){tickID&&window.cancelAnimationFrame(tickID);kz.scene&&kz.scene.exit();kz.entities={};kz.scene=b;kz.scene.initialize();kz.alive=!0;tickID=window.requestAnimationFrame(kz.tick)};kz.performance={pauseTime:0,now:function(){return kz.paused?kz.pauseNow:performance.now()-kz.performance.pauseTime}};
kz.paused=!1;kz.pauseTime=0;kz.pause=function(){kz.pauseNow=kz.performance.now();kz.pauseTime=performance.now();kz.paused=!0};kz.resume=function(){kz.performance.pauseTime+=performance.now()-kz.pauseTime;kz.paused=!1};var scene_loading=new kz.Scene;scene_loading.preUpdate=function(b){kz.events=[]};
scene_loading.draw=function(b){kz.context.clearAll();kz.context.save();kz.context.fillStyle="#30403b";kz.context.fillRect(0,0,kz.canvas.width,kz.canvas.height);kz.context.restore();text=["LOADING","LOADING.","LOADING..","LOADING..."];kz.context.save();kz.context.textAlign="center";kz.context.textBaseline="center";kz.context.font="18px f";kz.context.fillStyle="rgb(142, 212, 165)";kz.context.lineWidth=2;kz.context.fillText(text[Math.round(b/500)%4],kz.canvas.width/2,kz.canvas.height/2);kz.context.restore()};
var scene_main_menu=function(){var b=new kz.Scene,a;b.initialize=function(){a={press_space_visible:1,text_alpha:1,fadeAlpha:1,exiting:!1,choice:0,state:0};kz.tween({object:a,property:"fadeAlpha",value:0,duration:100});a.blinkID=setInterval(function(){a.press_space_visible^=1},400)};b.draw=function(){kz.context.clearAll();kz.context.save();kz.context.fillStyle="#30403b";kz.context.fillRect(0,0,kz.canvas.width,kz.canvas.height);kz.context.restore();kz.context.textAlign="center";kz.context.textBaseline=
"center";kz.context.font="48px f";kz.context.fillStyle="#8ed4a5";kz.context.fillText("ZODIAC 13",kz.canvas.width/2,125);0==a.state&&a.press_space_visible&&(kz.context.save(),kz.context.globalAlpha=a.text_alpha,kz.context.font="24px f",kz.context.fillStyle="white",kz.context.fillText("PRESS   Z",kz.canvas.width/2,250),kz.context.restore());1==a.state&&(kz.context.textAlign="center",kz.context.textBaseline="center",kz.context.font="24px f",kz.context.fillStyle=0==a.choice?"#fff":"#666",kz.context.fillText("GAME START",
kz.canvas.width/2,kz.canvas.height/2+40),kz.context.fillStyle=1==a.choice?"#fff":"#666",kz.context.fillText("RECORDS",kz.canvas.width/2,kz.canvas.height/2+88),kz.context.restore());kz.context.save();kz.context.globalAlpha=a.text_alpha;kz.context.font="10px f";kz.context.fillStyle="#50605b";kz.context.lineWidth=2;kz.context.fillText("HERMAN CHAU (KCAZE)",kz.canvas.width/2,380);kz.context.restore();kz.context.fillStyle="rgba(0,0,0,"+a.fadeAlpha+")";kz.context.fillRect(0,0,kz.canvas.width,kz.canvas.height)};
b.preUpdate=function(b){for(b=0;b<kz.events.length;b++){if("keypress"==kz.events[b].kztype){if(a.exiting)continue;if(kz.events[b].which==kz.KEYS.Z)if(kz.resources.sounds.sfx_select.play(),a.state){var c=a.choice?scene_records:scene_character_select;a.exiting=!0;kz.tween({object:a,property:"fadeAlpha",value:1,duration:100}).then(function(){clearInterval(a.blinkID);kz.run(c)})}else a.state=1}kz.events[b].which==kz.KEYS.UP&&a.state&&(a.choice=Math.max(0,a.choice-1));kz.events[b].which==kz.KEYS.DOWN&&
a.state&&(a.choice=Math.min(1,a.choice+1))}kz.events=[]};return b}(),scene_records=function(){var b,a=new kz.Scene,d;a.initialize=function(){d={fadeAlpha:1};kz.tween({object:d,property:"fadeAlpha",value:0,duration:100});b=!1};a.draw=function(){kz.context.clearAll();kz.context.save();kz.context.fillStyle="#30403b";kz.context.fillRect(0,0,kz.canvas.width,kz.canvas.height);kz.context.restore();kz.context.textAlign="center";kz.context.textBaseline="center";kz.context.font="32px f";kz.context.fillStyle=
"#fff";kz.context.fillText("RECORDS",kz.canvas.width/2,48);kz.context.font="12px f";for(var c=0;c<records.length;c++){kz.context.fillStyle="#fff";kz.context.textAlign="left";kz.context.fillText(records[c].text+": ",12,90+20*c);kz.context.textAlign="right";kz.context.fillStyle="#8ed4a5";var a;if("total_time"==records[c].name||"max_time"==records[c].name){a=getRecord(records[c].name);var b=""+a%60,h=""+Math.floor(a/60)%60;a=("total_time"==records[c].name?""+Math.floor(a/3600)+":":"")+"0".repeat(2-h.length)+
h+":"+"0".repeat(2-b.length)+b}else a=getRecord(records[c].name);kz.context.fillText(a,kz.canvas.width-12,90+20*c)}kz.context.fillStyle="rgba(0,0,0,"+d.fadeAlpha+")";kz.context.fillRect(0,0,kz.canvas.width,kz.canvas.height)};a.preUpdate=function(c){for(c=0;c<kz.events.length;c++)b||"keypress"!=kz.events[c].kztype||kz.events[c].which!=kz.KEYS.ESCAPE&&kz.events[c].which!=kz.KEYS.Z||(b=!0,kz.tween({object:d,property:"fadeAlpha",value:1,duration:100}).then(function(){kz.run(scene_main_menu)}));kz.events=
[]};return a}(),character,scene_character_select=function(){var b=new kz.Scene,a,d;b.initialize=function(){a={selected:0,exiting:!1,fadeAlpha:1};kz.tween({object:a,property:"fadeAlpha",value:0,duration:100});d=[{description:"ENDS TURN WHITE",name:"BOAR",image:kz.resources.images.character_boar,unlock_message:"13 WHITE ORBS IN A ROW",unlocked:13<=getRecord("max_white_orbs"),zodiac:function(c){for(var a=c.state,b=c.config,d=0;d<b.board_height;d++)a.board[d][0].piece_type&&1!=a.board[d][0].piece_type&&
(a.board[d][0].piece_type=1,c.animateColorChange(a.board[d][0].piece,1)),a.board[d][b.board_width-1].piece_type&&1!=a.board[d][b.board_width-1].piece_type&&(a.board[d][b.board_width-1].piece_type=1,c.animateColorChange(a.board[d][b.board_width-1].piece,1))}},{description:"CLEAR ROW ABOVE",name:"CAT",image:kz.resources.images.character_cat,unlocked:!0,zodiac:function(a){var b=a.state,d=a.config,h=a.row;h--;for(var m=[],p=0;p<d.board_width;p++)b.board[h][p].piece&&m.push(b.board[h][p].piece);for(p=
0;p<d.board_width;p++)b.board[h][p]={piece_type:0};a.animateClearPieces(m)}},{description:"CLEAR LEFT SIDE",name:"DOG",image:kz.resources.images.character_dog,unlock_message:"169 ORBS SHOT",unlocked:169<=getRecord("total_orbs"),zodiac:function(a){for(var b=a.state.board,d=[],h=0;h<a.config.board_height;h++)b[h][0].piece_type&&(d.push(b[h][0].piece),b[h][0].piece_type=0);a.animateClearPieces(d)}},{description:"CLEAR 4 ON ENDS",name:"DRAGON",image:kz.resources.images.character_dragon,unlock_message:"SCORE 169",
unlocked:169<=getRecord("max_score"),zodiac:function(a){for(var b=4,d=4,h=[],m=a.state.board,p=a.config.board_width,t=a.config.board_height-1;0<=t;t--)b&&m[t][0].piece_type&&(h.push(m[t][0].piece),m[t][0].piece_type=0,b--),d&&m[t][p-1].piece_type&&(h.push(m[t][p-1].piece),m[t][p-1].piece_type=0,d--);a.animateClearPieces(h)}},{description:"CLEAR 12 RANDOM",name:"HARE",image:kz.resources.images.character_hare,unlock_message:"REACH LEVEL 13",unlocked:13<=getRecord("max_level"),zodiac:function(a){for(var b=
a.state.board,d=0,h=[],m=[],p=0;p<a.config.board_height;p++)for(var t=0;t<a.config.board_width;t++)b[p][t].piece_type&&m.push({x:t,y:p});for(var d=Math.min(m.length,12),A=0;A<d;A++){var u=Math.floor(Math.random()*m.length),t=m[u].x,p=m[u].y;h.push(b[p][t].piece);b[p][t].piece_type=0;h.splice(u,1)}a.animateClearPieces(h)}},{description:"SCORE +2",name:"HORSE",image:kz.resources.images.character_horse,unlock_message:"ZODIAC 13 TIMES",unlocked:13<=getRecord("total_zodiac"),zodiac:function(a){a.incrementScore(2)}},
{description:"DELAY ROW DROP",name:"MONKEY",image:kz.resources.images.character_monkey,unlock_message:"ZODIAC 169 TIMES",unlocked:169<=getRecord("total_zodiac"),zodiac:function(a){var b=a.state;b.next_row_time_diff=b.next_row_time-kz.performance.now();b.next_row_freeze=!0;setTimeout(function(){b.next_row_freeze=!1},5E3)}},{description:"ENDS TURN BLACK",name:"OX",image:kz.resources.images.character_ox,unlock_message:"13 BLACK ORBS IN A ROW",unlocked:13<=getRecord("max_black_orbs"),zodiac:function(a){for(var b=
a.state,d=a.config,h=0;h<d.board_height;h++)b.board[h][0].piece_type&&2!=b.board[h][0].piece_type&&(b.board[h][0].piece_type=2,a.animateColorChange(b.board[h][0].piece,2)),b.board[h][d.board_width-1].piece_type&&2!=b.board[h][d.board_width-1].piece_type&&(b.board[h][d.board_width-1].piece_type=2,a.animateColorChange(b.board[h][d.board_width-1].piece,2))}},{description:"NEXT ALL WHITE",name:"RAT",image:kz.resources.images.character_rat,unlock_message:"1313 ORBS SHOT",unlocked:1313<=getRecord("total_orbs"),
zodiac:function(a){for(var b=0;8>b;b++)a.state.player.next[b]=1}},{description:"CLEAR RIGHT SIDE",name:"ROOSTER",image:kz.resources.images.character_rooster,unlock_message:"SURVIVE 13 MINUTES",unlocked:780<=getRecord("max_time"),zodiac:function(a){for(var b=a.state.board,d=[],h=a.state.board_width,m=0;m<a.config.board_height;m++)b[m][h-1].piece_type&&(d.push(b[m][h-1].piece),b[m][h-1].piece_type=0);a.animateClearPieces(d)}},{description:"CLEAR TOP ROW",name:"SHEEP",image:kz.resources.images.character_sheep,
unlock_message:"SCORE 13",unlocked:13<=getRecord("max_score"),zodiac:function(a){for(var b=a.state,d=a.config,h=[],m=0;m<d.board_width;m++)b.board[0][m].piece&&h.push(b.board[0][m].piece),b.board[0][m]={piece_type:0};a.animateClearPieces(h)}},{description:"NEXT ALL BLACK",name:"SNAKE",image:kz.resources.images.character_snake,unlock_message:"PLAY 13 GAMES",unlocked:13<=getRecord("play_count"),zodiac:function(a){for(var b=0;8>b;b++)a.state.player.next[b]=2}},{description:"SCORE +LEVEL/3",name:"TIGER",
image:kz.resources.images.character_tiger,unlock_message:"169 ROWS CLEARED",unlocked:169<=getRecord("total_rows"),zodiac:function(a){a.incrementScore(Math.floor(a.state.level/3))}},{description:"",name:"RANDOM",image:kz.resources.images.character_random,unlocked:!0}]};b.draw=function(b){kz.context.clearAll();kz.context.save();kz.context.fillStyle="#30403b";kz.context.fillRect(0,0,kz.canvas.width,kz.canvas.height);kz.context.restore();for(var f=0;7>f;f++)for(var k=0;2>k;k++){var h=2*f+k;if(h>=d.length)break;
kz.context.strokeStyle="#89928e";kz.context.lineWidth=.5;kz.context.fillStyle="#50605b";kz.context.fillRect(49*k+11,49*f+21,48,48);kz.context.strokeRect(49*k+10,49*f+20,50,50);kz.context.drawImage(d[h].image,49*k+10,49*f+20);d[h].unlocked||(kz.context.fillStyle="rgba(0,0,0,0.7)",kz.context.fillRect(49*k+11,49*f+21,48,48))}Math.floor(b/200)%3&&(kz.context.strokeStyle="#fff",kz.context.lineWidth=1,kz.context.strokeRect(a.selected%2*49+10,49*Math.floor(a.selected/2)+20,50,50));kz.context.textAlign="right";
kz.context.textBaseline="center";kz.context.font="24px f";kz.context.fillStyle="white";kz.context.fillText(d[a.selected].name,kz.canvas.width-10,330);kz.context.textAlign="right";kz.context.textBaseline="center";kz.context.font="16px f";kz.context.fillStyle="white";d[a.selected].unlocked?kz.context.fillText(d[a.selected].description,kz.canvas.width-10,360):(kz.context.font="12px f",kz.context.fillStyle="#50605b",kz.context.fillText(d[a.selected].unlock_message,kz.canvas.width-10,360));kz.context.fillStyle=
"rgba(0,0,0,"+a.fadeAlpha+")";kz.context.fillRect(0,0,kz.canvas.width,kz.canvas.height)};b.preUpdate=function(b){for(b=0;b<kz.events.length;b++)if(!a.exiting&&"keypress"==kz.events[b].kztype)if(kz.events[b].which==kz.KEYS.RIGHT)a.selected=Math.min(13,a.selected+1);else if(kz.events[b].which==kz.KEYS.DOWN)a.selected=Math.min(13,a.selected+2);else if(kz.events[b].which==kz.KEYS.LEFT)a.selected=Math.max(0,a.selected-1);else if(kz.events[b].which==kz.KEYS.UP)a.selected=Math.max(0,a.selected-2);else if(kz.events[b].which==
kz.KEYS.Z){if(13==a.selected)for(a.selected=Math.floor(13*Math.random());!d[a.selected].unlocked;)a.selected=Math.floor(13*Math.random());d[a.selected].unlocked?(kz.resources.sounds.sfx_select.play(),character=d[a.selected],a.exiting=!0,kz.tween({object:a,property:"fadeAlpha",value:1,duration:100}).then(function(){kz.run(scene_game)})):kz.resources.sounds.sfx_denied.play()}else kz.events[b].which==kz.KEYS.ESCAPE&&(a.exiting=!0,kz.tween({object:a,property:"fadeAlpha",value:1,duration:100}).then(function(){kz.run(scene_main_menu)}));
kz.events=[]};return b}(),previous_time,scene_game=function(){function b(){kz.tween({object:B,property:"pause_alpha",value:0,duration:50}).then(kz.resume)}function a(){return new Promise(function(a){a()})}function d(a){var b=a.length;return a[Math.floor(Math.random()*b)]}function c(b,c,d){return new kz.Entity({x:b,y:c,type:d,alpha:1,blend_alpha:0,blend_type:0,actions_promise:a()})}function f(a){return[kz.resources.images.piece_red,kz.resources.images.piece_blue,kz.resources.images.piece_zodiac][a-
1]}function k(){F.mystop();g.alive=!1;S.clearRect(0,0,n.width,n.height);S.drawImage(kz.canvas,0,0);kz.tween({object:B,property:"gameover_background_alpha",value:1,duration:1E3}).then(function(){return kz.tween({object:B,property:"gameover_text_alpha",value:1,duration:1E3})}).then(function(){g.can_restart=!0})}function h(a){kz.resources.sounds.sfx_clear.play();var b=[];a.forEach(function(a){b.push(a.actions_promise)});b=Promise.all(b);a.forEach(function(a){var c=b.then(function(){return kz.tween({object:a,
property:"alpha",value:0,duration:100}).then(function(){a.destroy()})});a.actions_promise=c})}function m(){for(var a=e.board_height-1;0<a;a--)for(var b=0;b<e.board_width;b++)g.board[a][b].piece_type&&!g.board[a-1][b].piece_type&&(g.board[a-1][b]=g.board[a][b],g.board[a][b]={piece_type:y.Empty},function(a){a.actions_promise=a.actions_promise.then(function(){return kz.tween({object:a,property:"y",value:a.y-e.grid_size,duration:100})})}(g.board[a-1][b].piece))}function p(a,b){var c=[1,-1,0,0,1,1,-1,
-1],d=[0,0,1,-1,1,-1,1,-1],f=g.board[b][a].piece_type;if(f!=y.Empty&&f!=y.Zodiac)for(var k=0;8>k;k++){for(var h=c[k],l=d[k],m=!1,q=1,n=a+q*h,p=b+q*l;0<=n&&0<=p&&n<e.board_width&&p<e.board_height&&g.board[p][n].piece_type!=y.Empty&&g.board[p][n].piece_type!=y.Zodiac;){if(g.board[p][n].piece_type==f){m=!0;break}q++;n=a+q*h;p=b+q*l}if(m)for(m=1;m<q;m++)n=a+m*h,p=b+m*l,g.board[p][n].piece_type=f,A(g.board[p][n].piece,f)}}function t(a){g.score+=a;maxRecord("max_score",g.score)}function A(a,b){a.actions_promise=
a.actions_promise.then(function(){return new Promise(function(c){a.blend_type=b;kz.tween({object:a,property:"blend_alpha",value:1,duration:100}).then(function(){a.type=b;a.blend_type=0;a.blend_alpha=0;c()})})})}function u(){kz.resources.sounds.sfx_drop.play();for(var a=[],b=0;b<e.board_width;b++){var f=d(L);a.push({piece_type:f,piece:c(1+20*b,-19,f)})}f=a[e.board_width-1].piece_type;for(b=0;b<e.board_width;b++)f^=a[b].piece_type;f&&(a[e.board_width-1].piece_type^=3,a[e.board_width-1].piece.type^=
3);for(b=0;b<e.board_width;b++){if(g.board[e.board_height-1][b].piece_type!=y.Empty){k();return}for(f=e.board_height-1;0<f;f--)g.board[f][b]=g.board[f-1][b];g.board[0][b]=a[b]}g.board.forEach(function(a){a.forEach(function(a){var b=a.piece;b&&(b.actions_promise=b.actions_promise.then(function(){return kz.tween({object:b,property:"y",value:b.y+e.grid_size,rate:1})}))})})}function z(a){for(a=0;a<kz.events.length;a++)"keypress"==kz.events[a].kztype&&kz.events[a].which==kz.KEYS.Z&&g.can_restart&&kz.tween({object:B,
property:"fadeAlpha",value:1,duration:100}).then(function(){kz.run(scene_main_menu)});kz.events=[]}function C(a){for(a=0;a<kz.events.length;a++)"keypress"==kz.events[a].kztype&&(kz.events[a].which==kz.KEYS.ESCAPE?b():kz.events[a].which==kz.KEYS.DOWN?D=Math.min(2,D+1):kz.events[a].which==kz.KEYS.UP?D=Math.max(0,D-1):kz.events[a].which==kz.KEYS.Z&&(b(),0!=D&&(1==D?kz.tween({object:B,property:"fadeAlpha",value:1,duration:100}).then(function(){kz.run(H)}):kz.tween({object:B,property:"fadeAlpha",value:1,
duration:100}).then(function(){kz.run(scene_main_menu)}))));kz.events=[]}var e={board_width:8,board_height:17,grid_size:20,next_length:8,next_row_interval:2E4},q=document.createElement("canvas"),r=document.createElement("canvas"),x=document.createElement("canvas"),n=document.createElement("canvas");q.width=e.board_width*e.grid_size;q.height=390;r.width=96;r.height=390;n.width=280;n.height=390;x.width=280;x.height=390;var l=q.getContext("2d"),v=r.getContext("2d"),S=n.getContext("2d"),T=x.getContext("2d"),
y={Empty:0,Red:1,Blue:2,Zodiac:3},L=[y.Red,y.Blue],g,D,B,F,H=new kz.Scene;H.initialize=function(){incrementRecord("play_count",1);F=kz.resources.sounds.bgm_game.play(!0);F.mystop=function(){F.stopped||(F.stop(0),F.stopped=1)};B={background_pattern:kz.context.createPattern(kz.resources.images.background,"repeat"),pause_alpha:0,gameover_background_alpha:0,gameover_text_alpha:0,fadeAlpha:1};kz.tween({object:B,property:"fadeAlpha",value:0,duration:100});g={alive:!0,begin:kz.performance.now(),board:[],
can_restart:!1,score:0,level:1,rows_cleared:0,next_row_interval:e.next_row_interval,next_row_time:0,next_row_time_diff:0,next_row_freeze:!1,zodiacs:0,consecutive:{1:0,2:0,3:0}};g.next_row_time=kz.performance.now()+g.next_row_interval;for(var b=0;b<e.board_height;b++){g.board.push([]);for(var f=0;f<e.board_width;f++)if(2>b){var h=d(L),m=c(1+20*f,1+20*b,h);g.board[b].push({piece_type:h,piece:m});if(f==e.board_width-1){h=g.board[b][0].piece_type;for(m=0;m<e.board_width;m++)h&=g.board[b][m].piece_type;
h&&(g.board[b][e.board_width-1].piece_type^=3,g.board[b][e.board_width-1].piece.type^=3)}}else g.board[b].push({piece_type:y.Empty})}D=0;g.player=new kz.Entity({frames:[kz.resources.images.shooter_0,kz.resources.images.shooter_1,kz.resources.images.shooter_2,kz.resources.images.shooter_3],frame_lengths:[500,200,200,200],current_frame:0,animate_timer:kz.performance.now(),animate:function(a){a-this.animate_timer>this.frame_lengths[this.current_frame]&&(this.current_frame++,this.current_frame%=this.frames.length,
this.animate_timer=a)},x:Math.floor(e.board_width/2),sprite_x:4+Math.floor(e.board_width/2)*e.grid_size,sprite_y:e.board_height*e.grid_size+23,actions_promise:a(),draw:function(a){a.drawImage(this.frames[this.current_frame],this.sprite_x,this.sprite_y);for(a=e.board_height-1;0<=a&&g.board[a][this.x].piece_type==y.Empty;a--);l.save();l.globalAlpha=1;l.lineWidth=1;l.setLineDash([2,8]);l.strokeStyle="#8ed4a5";l.beginPath();l.moveTo(this.sprite_x+e.grid_size/2-5,this.sprite_y-8);l.lineTo(this.sprite_x+
e.grid_size/2-5,(a+1)*e.grid_size+20);l.stroke();l.restore()},listen:function(a){if("keypress"==a.kztype)switch(a.which){case kz.KEYS.LEFT:this.move(-1);break;case kz.KEYS.RIGHT:this.move(1);break;case kz.KEYS.Z:this.shoot()}else if("keyheld"==a.kztype)switch(a.which){case kz.KEYS.LEFT:this.move(-1);break;case kz.KEYS.RIGHT:this.move(1)}},move:function(b){0<=this.x+b&&this.x+b<e.board_width&&(this.x+=b,this.actions_promise=this.actions_promise.then(function(){return kz.tween({object:this,property:"sprite_x",
value:this.sprite_x+b*e.grid_size,rate:.7}).then(function(){return a()}.bind(this))}.bind(this)))},next:[],shoot:function(){if(g.board[e.board_height-1][this.x].piece_type!=y.Empty)k();else{incrementRecord("total_orbs",1);var a=this.next.shift(),b=1<16*Math.random()?d(L):y.Zodiac;this.next.push(b);g.consecutive[a]?g.consecutive[a]++:(g.consecutive[y.Red]=0,g.consecutive[y.Blue]=0,g.consecutive[y.Zodiac]=0,g.consecutive[a]=1);maxRecord({1:"max_white_orbs",2:"max_black_orbs",3:"max_zodiac_orbs"}[a],
g.consecutive[a]);for(var f=e.board_height-1;0<f&&g.board[f-1][this.x].piece_type==y.Empty;)f--;var h=c(this.x*e.grid_size+1,(e.board_height-1)*e.grid_size+1,a);g.board[f][this.x]={piece_type:a,piece:h};p(this.x,f);h.actions_promise=h.actions_promise.then(function(){kz.resources.sounds.sfx_shoot.play();return kz.tween({object:h,property:"y",value:1+20*f,rate:3})})}}});for(b=0;8>b;b++)g.player.next.push(d(L)),1>16*Math.random()&&(g.player.next[b]=y.Zodiac)};H.draw=function(a){if(kz.paused)kz.context.clearAll(),
kz.context.save(),kz.context.globalAlpha=1,kz.context.drawImage(x,0,0),kz.context.globalAlpha=B.pause_alpha,kz.context.fillStyle="#000000",kz.context.fillRect(0,0,kz.canvas.width,kz.canvas.height),kz.context.restore(),kz.context.save(),kz.context.textAlign="center",kz.context.textBaseline="center",kz.context.font="24px f",kz.context.fillStyle=0==D?"#fff":"#666",kz.context.fillText("RESUME",kz.canvas.width/2,kz.canvas.height/2-48),kz.context.fillStyle=1==D?"#fff":"#666",kz.context.fillText("RESTART",
kz.canvas.width/2,kz.canvas.height/2),kz.context.fillStyle=2==D?"#fff":"#666",kz.context.fillText("QUIT",kz.canvas.width/2,kz.canvas.height/2+48),kz.context.restore();else if(g.alive){l.clearRect(0,0,q.width,q.height);v.clearRect(0,0,r.width,r.height);l.fillStyle="rgba(0,0,0,0.5)";l.fillRect(0,0,q.width,q.height);l.save();l.globalAlpha=1;l.lineWidth=1;l.strokeStyle="#50605b";l.beginPath();l.moveTo(0,e.board_height*e.grid_size+20);l.lineTo(e.board_width*e.grid_size,e.board_height*e.grid_size+20);l.stroke();
l.restore();for(var b in kz.entities){var c=kz.entities[b];c.type&&(l.globalAlpha=c.alpha,l.drawImage(f(c.type),c.x,c.y+20),c.blend_type&&(l.globalAlpha=c.blend_alpha,l.drawImage(f(c.blend_type),c.x,c.y+20)))}l.globalAlpha=1;g.player.draw(l);l.fillStyle="rgba(0, 0, 0, 0.5)";l.fillRect(0,8,q.width,5);l.fillStyle=g.next_row_freeze?"rgb(80, 96, 91)":"rgb(142, 212, 165)";l.fillRect(0,8,q.width*(g.next_row_time-a)/g.next_row_interval,5);v.fillStyle="rgba(0, 0, 0, 0.5)";v.fillRect(0,10,r.width,r.width);
v.fillRect(0,117,r.width,80);v.fillRect(0,208,r.width,50);v.fillRect(0,269,r.width,50);v.fillRect(0,330,r.width,50);v.textAlign="center";v.textBaseline="top";v.font="24px f";v.fillStyle="white";v.fillText("NEXT",48,120);v.fillText("SCORE",48,211);v.fillText("LEVEL",48,272);v.fillText("TIME",48,333);v.font="20px f";v.textBaseline="bottom";v.fillText(character.name,48,101);v.font="20px f";v.fillText(""+g.level,48,316);a=""+g.score;a="0".repeat(5-a.length)+a;v.fillText(a,48,255);b=Math.floor((kz.performance.now()-
g.begin)/1E3);a=""+b%60;b=""+Math.floor(b/60);time_string="0".repeat(2-b.length)+b+":"+"0".repeat(2-a.length)+a;v.fillText(time_string,48,377);for(a=0;a<e.next_length;a++)v.drawImage(f(g.player.next[a]),9+a%4*e.grid_size,148+23*Math.floor(a/4));v.drawImage(character.image,23,20);kz.context.fillStyle="#50605b";kz.context.fillRect(0,0,kz.canvas.width,kz.canvas.height);kz.context.fillStyle=B.background_pattern;kz.context.fillRect(0,0,kz.canvas.width,kz.canvas.height);kz.context.drawImage(q,10,0);kz.context.drawImage(r,
10+q.width+7,0)}else kz.context.clearAll(),kz.context.save(),kz.context.globalAlpha=1,kz.context.drawImage(n,0,0),kz.context.globalAlpha=B.gameover_background_alpha,kz.context.fillStyle="rgb(142, 212, 165)",kz.context.fillRect(10,kz.canvas.height/2-28,160,42),kz.context.globalAlpha=B.gameover_text_alpha,kz.context.textAlign="center",kz.context.textBaseline="center",kz.context.font="24px f",kz.context.fillStyle="#fff",kz.context.fillText("GAME OVER",kz.canvas.width/2-46,kz.canvas.height/2),kz.context.restore();
kz.context.fillStyle="rgba(0,0,0,"+B.fadeAlpha+")";kz.context.fillRect(0,0,kz.canvas.width,kz.canvas.height)};H.preUpdate=function(a){if(kz.paused)C(a);else if(g.alive)a:{maxRecord("max_time",Math.floor((a-g.begin)/1E3));for(var b=0;b<kz.events.length;b++)if("keypress"==kz.events[b].kztype&&kz.events[b].which==kz.KEYS.ESCAPE){kz.pause();D=0;T.clearRect(0,0,x.width,x.height);T.drawImage(kz.canvas,0,0);kz.tween({object:B,property:"pause_alpha",value:.8,duration:50});kz.events=[];break a}kz.processEvents();
g.player.animate(a);g.next_row_freeze&&(g.next_row_time=a+g.next_row_time_diff);g.next_row_time<a&&(u(),g.next_row_time=a+g.next_row_interval);var c;a=!1;for(var d=0;d<e.board_height;d++){for(var f=g.board[d][0].piece_type,k=0,l=!0,b=0;b<e.board_width;b++)if(g.board[d][b].piece_type==y.Zodiac&&k++,f&=g.board[d][b].piece_type,0==f){l=!1;break}if(l){0<k&&(a=!0);c=d;break}}if("undefined"!==typeof c){t(1);g.rows_cleared+=1;incrementRecord("total_rows",1);maxRecord("max_rows",g.rows_cleared);0==g.rows_cleared%
10&&(g.level+=1,maxRecord("max_level",g.level),g.next_row_interval=Math.max(3E3,g.next_row_interval-750));d=[];for(b=0;b<e.board_width;b++)d.push(g.board[c][b].piece);for(b=0;b<e.board_width;b++)g.board[c][b]={piece_type:y.Empty};h(d);a&&(g.zodiacs++,incrementRecord("total_zodiac",1),maxRecord("max_zodiac",g.zodiacs),character.zodiac({state:g,animateClearPieces:h,animateColorChange:A,config:e,incrementScore:t,row:c}))}m()}else z(a)};H.exit=function(){F.mystop()};return H}();
function loadJSFXR(b,a){var d=base64ToArrayBuffer(b.substr(22));kz.audio_context.decodeAudioData(d,a)}function loadSonant(b,a){(new sonantx.MusicGenerator(b)).createAudioBuffer(a)}
var resources={images:{background:{x:36,y:263,w:32,h:32},character_boar:{x:0,y:0,w:50,h:50,W:37,H:39,f:1},character_cat:{x:37,y:0,w:50,h:50,W:42,H:38,f:1},character_dog:{x:0,y:39,w:50,h:50,W:40,H:42,f:1},character_dragon:{x:40,y:38,w:50,h:50,W:45,H:40,f:1},character_hare:{x:0,y:81,w:50,h:50,W:35,H:40,f:1},character_horse:{x:35,y:81,w:50,h:50,W:41,H:43,f:1},character_monkey:{x:0,y:121,w:50,h:50,W:30,H:44,f:1},character_ox:{x:30,y:124,w:50,h:50,W:42,H:32,f:1},character_rat:{x:0,y:165,w:50,h:50,W:41,
H:39,f:1},character_rooster:{x:41,y:156,w:50,h:50,W:35,H:36,f:1},character_sheep:{x:0,y:205,w:50,h:50,W:43,H:43,f:1},character_snake:{x:43,y:192,w:50,h:50,W:34,H:34,f:1},character_tiger:{x:0,y:248,w:50,h:50,W:36,H:41,f:1},character_random:{x:43,y:226,w:50,h:50,W:21,H:37,f:1},piece_blue:{x:65,y:226,w:17,h:17},piece_red:{x:64,y:243,w:17,h:17},piece_zodiac:{x:72,y:124,w:17,h:17},shooter_0:{x:68,y:260,w:9,h:22,W:9,H:22,f:1},shooter_1:{x:76,y:81,w:9,h:22,W:5,H:22,f:1},shooter_2:{x:76,y:156,w:9,h:22,W:1,
H:22,f:1},shooter_3:{x:68,y:260,w:9,h:22,W:9,H:22,f:1}},sounds:{sfx_shoot:{data:jsfxr([0,,.1881,,.3164,.8042,.2,-.2915,,,,,,.4661,.156,,.1754,-.182,1,,,.1755,,.5]),loader:loadJSFXR},sfx_clear:{data:jsfxr([1,,.06,.4848,.4938,.8917,,,,,,,,,,,,,1,,,,,.49]),loader:loadJSFXR},sfx_select:{data:jsfxr([0,,.0538,.4336,.3186,.4583,,,,,,.5712,.5566,,,,,,1,,,,,.5]),loader:loadJSFXR},sfx_denied:{data:jsfxr([0,,.24,.51,.3829,.15,,,,,,,,,,,,,1,,,,,.5]),loader:loadJSFXR},sfx_drop:{data:jsfxr([1,,.0468,,.2103,.4979,
,-.4519,,,,,,,,,,,1,,,,,.83]),loader:loadJSFXR},bgm_game:{loader:loadSonant,data:{endPattern:382,songData:[{a:0,b:0,c:108,d:0,e:187,f:0,g:60,h:0,i:8,j:1,k:120,l:5,m:0,n:4,o:10332,p:0,r:0,s:16,t:0,notes:[147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,
0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,
147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0,147,0,0,0],u:0,v:0,w:4607,x:419,y:0,z:5,_:130,aa:0,ab:50,ac:8},{a:0,b:0,c:0,d:255,e:96,f:0,g:0,h:0,i:8,j:2,k:60,l:0,m:0,n:1,o:4067,p:0,r:255,s:45,t:0,notes:[160,0,160,0,155,0,0,0,148,160,162,0,163,162,160,0,163,0,163,162,163,0,151,163,165,0,0,0,167,0,165,0,167,0,163,0,162,0,163,0,156,0,151,162,158,0,0,0,151,0,155,0,151,0,150,0,151,0,150,0,151,0,150,155,160,0,
160,0,155,0,148,0,160,0,162,0,160,0,158,160,160,0,158,0,162,160,158,151,146,0,153,0,158,0,153,150,150,0,153,0,151,0,153,0,151,156,158,0,153,0,151,0,158,0,155,0,153,0,151,0,163,0,0,163,0,158,0,151,160,0,160,155,0,160,155,0,0,160,0,162,160,158,160,156,158,0,153,0,150,0,156,0,158,150,143,0,138,0,150,138,150,0,141,0,138,0,150,138,150,0,141,0,0,138,0,150,150,0,148,0,151,0,150,0,148,0,153,160,151,0,0,0,160,0,160,0,156,0,153,0,151,150,0,160,0,156,0,153,153,0,146,0,153,0,158,0,165,0,153,150,153,0,155,0,155,
0,153,155,153,0,151,0,153,0,153,0,151,0,153,0,153,0,158,0,160,0,158,0,151,146,151,0,0,0,153,0,163,0,0,0,163,160,163,0,156,0,151,163,170,0,167,163,170,0,160,0,151,163,170,0,167,163,170,0,160,0,0,0,160,0,0,0,170,0,168,0,167,0,0,167,0,170,0,168,168,0,167,0,165,0,167,0,168,0,165,0,0,168,0,165,163,0,163,156,0,0,151,0,0,151,0,156,0,158,0,156,158,0,151,144,156,158,0,151,144,158,0,151,144,156,158,0,158,0,155,0,158,153,151,0,153,165,153,0,148,0,146,0,146,0,153,0,148,0,151,0,155,0,158,0,155,0],u:1,v:0,w:13163,
x:0,y:0,z:3,_:255,aa:0,ab:22,ac:7},{a:2,b:0,c:0,d:157,e:0,f:0,g:0,h:0,i:6,j:2,k:76,l:2,m:0,n:3,o:3900,p:0,r:192,s:0,t:2,notes:[160,0,148,0,160,0,148,0,160,172,148,160,172,172,148,0,146,0,170,0,158,158,170,146,158,158,158,146,158,146,0,156,168,156,168,156,0,168,156,156,0,168,0,144,0,144,0,155,0,143,167,167,0,167,155,155,155,167,155,143,0,160,160,148,160,148,172,148,0,160,0,160,172,148,0,148,0,146,0,158,0,158,158,170,170,146,170,170,158,158,158,158,156,0,156,0,144,168,156,168,144,168,156,156,144,156,
156,0,155,0,143,155,143,0,155,143,167,155,155,143,167,143,0,160,172,172,160,160,148,172,160,0,148,0,160,0,160,0,158,0,158,0,158,146,0,158,158,158,0,158,0,146,0,168,156,168,168,168,144,156,168,156,168,156,0,144,0,143,155,143,155,143,167,143,155,167,0,155,0,155,0,155,0,148,160,160,0,172,0,148,0,160,160,148,0,160,160,0,146,0,170,0,158,0,146,0,158,0,146,0,146,0,158,0,156,156,156,0,144,0,168,168,144,0,156,168,156,156,144,0,143,155,143,0,143,0,155,0,143,155,167,167,155,0,143,0,151,0,163,0,151,0,151,0,163,
0,151,0,151,163,151,0,160,0,148,0,172,160,148,0,160,172,148,160,148,0,160,0,144,168,168,168,144,0,156,156,156,0,156,0,144,168,168,158,0,158,0,146,0,158,0,158,0,158,170,146,158,158,0,151,0,163,175,175,0,163,163,163,151,175,151,0,151,0,160,0,148,0,148,0,160,172,148,0,148,0,160,0,148,0,156,0,144,156,144,168,156,168,144,0,156,0,156,0,144,0,158,170,158,0,158,0,158,0,170,0,158,170],u:1,v:0,w:12631,x:2418,y:0,z:0,_:139,aa:0,ab:0,ac:5}],rowLen:1739,songLen:46}}}};
window.onload=function(){var b=document.getElementById("fontHack");b.parentNode.removeChild(b);kz.initialize("canvas");kz.run(scene_loading);kz.loadResources(resources).then(function(){kz.run(scene_main_menu);setInterval(function(){incrementRecord("total_time",1)},1E3)})};
var records=[{text:"GAMES PLAYED",name:"play_count"},{text:"TOTAL TIME SPENT",name:"total_time"},{text:"LONGEST TIME SURVIVED",name:"max_time"},{text:"HIGHEST SCORE OBTAINED",name:"max_score"},{text:"HIGHEST LEVEL REACHED",name:"max_level"},{text:"TOTAL ROWS CLEARED",name:"total_rows"},{text:"MOST ROWS CLEARED IN ONE GAME",name:"max_rows"},{text:"TOTAL ZODIAC CLEARS",name:"total_zodiac"},{text:"MOST ZODIACS CLEARS IN ONE GAME",name:"max_zodiac"},{text:"TOTAL ORBS SHOT",name:"total_orbs"},{text:"MAX CONSECUTIVE WHITE ORBS",
name:"max_white_orbs"},{text:"MAX CONSECUTIVE BLACK ORBS",name:"max_black_orbs"},{text:"MAX CONSECUTIVE ZODIAC ORBS",name:"max_zodiac_orbs"}];(function(){records.forEach(function(b){localStorage.getItem(b.name)||localStorage.setItem(b.name,"0")})})();function incrementRecord(b,a){localStorage.setItem(b,parseInt(localStorage.getItem(b),10)+a)}function maxRecord(b,a){localStorage.setItem(b,Math.max(parseInt(localStorage.getItem(b),10),a))}
function getRecord(b){return parseInt(localStorage.getItem(b),10)};
</script>
-->
</body>
</html>
